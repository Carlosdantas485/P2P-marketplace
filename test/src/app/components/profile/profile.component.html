<div *ngIf="user$ | async as user; else loading">
  <div class="profile-container">
    <div class="profile-actions">
      <button (click)="toggleEdit()" *ngIf="!isEditing">Editar Perfil</button>
    </div>

    <!-- Viewing Mode -->
    <div *ngIf="!isEditing">
      <div class="profile-header">
        <img [src]="user.foto || 'assets/default-profile.png'" alt="Foto do Perfil" class="profile-picture">
        <h2>{{ user.username }}</h2>
        <p>{{ user.email }}</p>
      </div>
      <div class="profile-details">
        <h3>Detalhes da Conta</h3>
        <p><strong>Saldo:</strong> R$ {{ user.saldo | number:'1.2-2' }}</p>
        <p><strong>Nível:</strong> {{ user.nivel }}</p>
        <p><strong>Vendas Realizadas:</strong> {{ user.vendas }}</p>
      </div>
    </div>

    <!-- Editing Mode -->
    <div *ngIf="isEditing">
      <form [formGroup]="editProfileForm" (ngSubmit)="onSave()">
        <div class="form-group">
          <label for="username">Nome de Usuário:</label>
          <input id="username" formControlName="username">
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input id="email" type="email" formControlName="email">
        </div>
        <div class="form-group">
          <label for="foto">URL da Foto:</label>
          <input id="foto" formControlName="foto">
        </div>
        <div class="form-actions">
          <button type="submit" [disabled]="editProfileForm.invalid">Salvar</button>
          <button type="button" (click)="toggleEdit()">Cancelar</button>
        </div>
      </form>
    </div>

    <div class="transaction-history">
      <h3>Histórico de Transações</h3>
      <div *ngIf="user.historicoTransferencias && user.historicoTransferencias.length > 0; else noHistory">
        <ul>
          <li *ngFor="let transacao of user.historicoTransferencias">
            <span>{{ transacao.tipo }}: {{ transacao.skinNome }}</span>
            <span>R$ {{ transacao.preco | number:'1.2-2' }}</span>
            <span>{{ transacao.data | date:'dd/MM/yyyy' }}</span>
          </li>
        </ul>
      </div>
      <ng-template #noHistory>
        <p>Nenhuma transação encontrada.</p>
      </ng-template>
    </div>
  </div>
</div>

<ng-template #loading>
  <p>Carregando perfil...</p>
</ng-template>
