<div class="container">
  <div class="toolbar">
    <button class="add-button" (click)="openAddForm()">Adicionar Novo Item</button>
  </div>

  <!-- Formulário Modal para Adicionar/Editar Item -->
  <div *ngIf="showForm" class="form-overlay" (click)="closeForm()">
    <div class="item-form-container" (click)="$event.stopPropagation()">
      <h2>{{ isEditing ? 'Editar Item' : 'Adicionar Novo Item' }}</h2>
      <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="nome">Nome do Item</label>
          <input id="nome" formControlName="nome" required>
        </div>
        <div class="form-group">
          <label for="descricao">Descrição</label>
          <textarea id="descricao" formControlName="descricao" required></textarea>
        </div>
        <div class="form-group">
          <label for="imagem">URL da Imagem</label>
          <input id="imagem" formControlName="imagem" required>
        </div>
        <div class="form-group">
          <label for="float">Float</label>
          <input id="float" type="number" formControlName="float" step="0.0001" min="0" max="1" required>
        </div>
        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="closeForm()">Cancelar</button>
          <button type="submit" class="submit-btn" [disabled]="itemForm.invalid">
            {{ isEditing ? 'Salvar Alterações' : 'Adicionar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Campo de filtro por nome -->
  <div class="filter-bar">
    <input type="text" placeholder="Filtrar por nome" [(ngModel)]="filterText" (ngModelChange)="onFilterChange()" />
  </div>

  <!-- Grid de Itens do Inventário -->
  <div class="skins-grid" *ngIf="inventory$ | async as items; else loading">
    <div *ngIf="items.length === 0" class="no-items">
      Você ainda não possui itens no inventário.
    </div>
    <div class="skin-card" *ngFor="let item of items">
      <div class="card-header">
        <!-- Avatar do dono não exibido no inventário -->
        <button class="wishlist-button new-wishlist-btn" style="visibility:hidden;"></button>
      </div>
      <img [src]="item.imagem" [alt]="item.nome" class="skin-image">
      <div class="skin-info">
        <h3>{{ item.nome }}</h3>
        <div class="float-bar-container">
          <div class="float-bar-bg">
            <div class="float-bar-indicator" [style.left]="(item.float * 100) + '%'">
              <span class="float-indicator-value"></span>
            </div>
          </div>
          <div class="float-bar-labels">
            <span>0.00</span>
            <span>0.07</span>
            <span>0.15</span>
            <span>0.38</span>
            <span>0.45</span>
            <span>1.00</span>
          </div>
        </div>
        <p class="price">{{ item.venda ? (item.preco | currency:'BRL') : 'Não à venda' }}</p>
        <div class="item-actions">
          <button class="edit-btn" (click)="openEditForm(item)">Editar</button>
          <button class="sell-btn" (click)="toggleSale(item)">
            {{ item.venda ? 'Remover da Venda' : 'Vender' }}
          </button>
          <button class="delete-btn" (click)="deleteItem(item.id)">Deletar</button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #loading>
    <div class="loading">Carregando inventário...</div>
  </ng-template>
</div>
